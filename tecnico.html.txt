<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Técnico - InspetorPro</title>

  <script type="module">
    import { supabase } from "./supabase.js";

    async function carregarFila() {
      const { data } = await supabase
        .from("vehicles")
        .select("*")
        .eq("status", "aguardando")
        .order("created_at", { ascending: true });

      const lista = document.getElementById("lista");
      lista.innerHTML = "";

      data.forEach(v => {
        const li = document.createElement("li");
        li.innerHTML = `${v.nome} — ${v.servico} 
          <button onclick="chamar(${v.id}, '${v.nome}', '${v.servico}')">Chamar</button>`;
        lista.appendChild(li);
      });
    }

    async function chamar(id, nome, servico) {
      await supabase.from("vehicles").update({ status: "chamado" }).eq("id", id);

      await supabase.from("painel").upsert({
        id: 1,
        nome,
        servico,
        tipo_chamada: "chamar",
        updated_at: new Date()
      });

      alert("Chamado!");
    }

    setInterval(carregarFila, 1000);
  </script>
</head>

<body>
  <h2>Técnico</h2>
  <ul id="lista"></ul>
</body>
</html>
