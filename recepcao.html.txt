<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>InspetorPro — Recepção</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body{font-family:Arial;padding:18px;max-width:960px;margin:auto}
    input, select{padding:10px;margin:6px 0; width:100%}
    button{padding:10px 16px;margin-top:8px}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid #ddd;padding:8px;text-align:left}
    .ok{color:green}
  </style>
</head>
<body>
  <h2>InspetorPro — Recepção</h2>

  <div style="max-width:520px">
    <input id="nome" placeholder="Nome do condutor"/>
    <input id="placa" placeholder="Placa (opcional)"/>
    <select id="servico">
      <option value="CIV">CIV</option>
      <option value="CSV">CSV</option>
      <option value="CIPP">CIPP</option>
      <option value="LIT">LIT</option>
      <option value="LAUDOS">LAUDOS</option>
      <option value="DESCONTAMINACAO">DESCONTAMINACAO</option>
    </select>
    <button id="btnReg">Registrar Veículo</button>
    <div id="msg" style="margin-top:8px"></div>
  </div>

  <h3>Fila (atualiza automaticamente)</h3>
  <table id="tbl">
    <thead><tr><th>Nome</th><th>Placa</th><th>Serviço</th><th>Status</th></tr></thead>
    <tbody></tbody>
  </table>

<script type="module">
  import { supabase } from '/supabase.js';

  const tbody = document.querySelector('#tbl tbody');
  document.getElementById('btnReg').addEventListener('click', async ()=>{
    const nome = document.getElementById('nome').value.trim();
    const placa = document.getElementById('placa').value.trim();
    const servico = document.getElementById('servico').value;
    if(!nome){ alert('Preencha o nome'); return; }
    const { error } = await supabase.from('vehicles').insert([{ nome, placa, servico, status:'aguardando' }]);
    if(error){ alert('Erro: '+error.message); return; }
    document.getElementById('msg').innerHTML = '<span class="ok">Veículo registrado!</span>';
    document.getElementById('nome').value=''; document.getElementById('placa').value='';
    setTimeout(()=>document.getElementById('msg').innerText='',2500);
  });

  function renderList(list){
    tbody.innerHTML='';
    list.sort((a,b)=> new Date(a.created_at) - new Date(b.created_at)).forEach(v=>{
      const tr=document.createElement('tr');
      tr.innerHTML = `<td>${v.nome}</td><td>${v.placa||''}</td><td>${v.servico}</td><td>${v.status}</td>`;
      tbody.appendChild(tr);
    });
  }

  // initial load
  (async ()=>{
    const { data } = await supabase.from('vehicles').select('*');
    renderList(data || []);
  })();

  // realtime updates
  supabase
    .channel('public:vehicles')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'vehicles' }, payload => {
      (async ()=>{
        const { data } = await supabase.from('vehicles').select('*');
        renderList(data || []);
      })();
    })
    .subscribe();
</script>
</body>
</html>
